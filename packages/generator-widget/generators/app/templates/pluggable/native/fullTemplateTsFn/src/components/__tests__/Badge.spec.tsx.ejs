import { createElement } from "react";
import { render, fireEvent } from "@testing-library/react-native";
import { Platform } from "react-native";

import { Badge, BadgeProps } from "../Badge";

describe.each(["ios", "android"])("Badge for %s", (os: "ios" | "android") => {
    beforeEach(() => {
        Platform.OS = os;
        Platform.select = jest.fn((dict: any) => dict[Platform.OS]);
    });

    it("renders the structure correctly", () => {
        const badgeProps: BadgeProps = {
            style: [],
            onClick: jest.fn(),
            value: "0"
        };
        const component = render(<Badge {...badgeProps} />);

        expect(component.toJSON()).toMatchSnapshot();
    });

    it("renders the structure correctly with custom style", () => {
        const badgeProps: BadgeProps = {
            style: [{ container: { display: "flex" }, badge: { borderColor: "white" }, label: { color: "black" } }],
            onClick: jest.fn(),
            value: "0"
        };
        const component = render(<Badge {...badgeProps} />);

        expect(component.toJSON()).toMatchSnapshot();
    });

    it("triggers the onClick action when pressed", () => {
        const badgeProps: BadgeProps = {
            style: [],
            onClick: jest.fn(),
            value: "0"
        };
        const component = render(<Badge {...badgeProps} />);

        const touchable = component.getByRole("button");
        fireEvent.press(touchable);

        expect(badgeProps.onClick).toHaveBeenCalled();
    });
});
